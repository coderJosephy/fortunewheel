<script>
  const slices = [
    { emoji: "💰", label: "Jackpot", reward: 500 },
    { emoji: "🍀", label: "Lucky", reward: 200 },
    { emoji: "😃", label: "Smile", reward: 100 },
    { emoji: "🧁", label: "Treat", reward: 80 },
    { emoji: "🎉", label: "Party", reward: 150 },
    { emoji: "🔮", label: "Mystery", reward: 120 },
    { emoji: "🌈", label: "Rainbow", reward: 300 },
    { emoji: "💎", label: "Gem", reward: 400 }
  ];

  const colors = [
    "#FF6384", "#36A2EB", "#FFCE56", "#4BC0C0", "#9966FF", "#FF9F40", "#50C878", "#E2E2E2"
  ];

  const wheelCanvas = document.getElementById('wheel');
  const ctx = wheelCanvas.getContext('2d');
  const spinBtn = document.getElementById('spinBtn');
  const resultDiv = document.getElementById('result');

  // 💰 Money system
  let balance = 1000;
  const spinCost = 50;

  // Display balance
  const balanceDiv = document.createElement('div');
  balanceDiv.style.fontSize = '1.3em';
  balanceDiv.style.marginTop = '10px';
  document.body.insertBefore(balanceDiv, resultDiv);
  updateBalanceDisplay();

  function updateBalanceDisplay() {
    balanceDiv.textContent = `Balance: $${balance}`;
  }

  let spinning = false;
  let wheelRotation = 0;

  function drawWheel(rotation = 0) {
    const radius = wheelCanvas.width / 2;
    const centerX = wheelCanvas.width / 2;
    const centerY = wheelCanvas.height / 2;
    const sliceAngle = (2 * Math.PI) / slices.length;

    ctx.clearRect(0, 0, wheelCanvas.width, wheelCanvas.height);

    for (let i = 0; i < slices.length; i++) {
      const angle = rotation + i * sliceAngle;
      ctx.beginPath();
      ctx.moveTo(centerX, centerY);
      ctx.arc(centerX, centerY, radius, angle, angle + sliceAngle, false);
      ctx.closePath();
      ctx.fillStyle = colors[i % colors.length];
      ctx.fill();
      ctx.save();

      ctx.translate(centerX, centerY);
      ctx.rotate(angle + sliceAngle / 2);
      ctx.textAlign = 'center';
      ctx.font = "2.2em serif";
      ctx.fillText(slices[i].emoji, radius * 0.62, 18);
      ctx.font = "bold 1em sans-serif";
      ctx.fillStyle = "#222";
      ctx.fillText(slices[i].label, radius * 0.62, 44);
      ctx.restore();
    }

    ctx.beginPath();
    ctx.arc(centerX, centerY, 38, 0, 2 * Math.PI);
    ctx.fillStyle = "#FFD700";
    ctx.fill();
    ctx.strokeStyle = "#B09700";
    ctx.lineWidth = 4;
    ctx.stroke();
    ctx.font = "1.8em serif";
    ctx.fillStyle = "#333";
    ctx.textAlign = 'center';
    ctx.fillText("🎯", centerX, centerY + 13);
  }

  drawWheel();

  spinBtn.onclick = function () {
    if (spinning) return;
    if (balance < spinCost) {
      resultDiv.textContent = "Not enough money to spin!";
      return;
    }

    // Deduct spin cost
    balance -= spinCost;
    updateBalanceDisplay();
    spinning = true;
    resultDiv.textContent = "";

    const sliceAngle = 2 * Math.PI / slices.length;
    const pickedIndex = Math.floor(Math.random() * slices.length);
    const stopAngle = (3 * Math.PI / 2) - (pickedIndex * sliceAngle) - (sliceAngle / 2);
    const extraSpins = 4;
    const finalRotation = (2 * Math.PI * extraSpins) + stopAngle;

    let start = null;
    let duration = 3000;
    let initialRotation = wheelRotation;

    function animateWheel(ts) {
      if (!start) start = ts;
      let elapsed = ts - start;
      let progress = Math.min(elapsed / duration, 1);
      let eased = 1 - Math.pow(1 - progress, 3);
      wheelRotation = initialRotation + eased * (finalRotation - initialRotation);
      drawWheel(wheelRotation);

      if (progress < 1) {
        requestAnimationFrame(animateWheel);
      } else {
        spinning = false;
        wheelRotation = finalRotation % (2 * Math.PI);
        drawWheel(wheelRotation);

        // Add winnings
        let prize = slices[pickedIndex].reward;
        balance += prize;
        updateBalanceDisplay();

        resultDiv.textContent = `You got: ${slices[pickedIndex].emoji} ${slices[pickedIndex].label}! (+$${prize})`;
      }
    }
    requestAnimationFrame(animateWheel);
  };
</script>
